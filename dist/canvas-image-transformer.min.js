const CanvasImageTransformer=function(){const a=function(c,d,e,b){return(c<<24)+(d<<16)+(e<<8)+b},b=function(a,b,c,d){const e=4*(c+d*b);return[a[e]/255,a[e+1]/255,a[e+2]/255,a[e+3]/255]},c=function(a,b){this.getMatrixArray=function(){return a},this.getWidth=function(){return b}};return{colorToRGBA:function(a){return[255&a>>24,255&a>>16,255&a>>8,255&a]},rgbaToColor:a,createKernel:function(a,b){return new c(a,b)},imageToCanvas:function(a,b,c,d){d&&(a.width>a.height?c*=a.height/a.width:a.height>a.width&&(b*=a.width/a.height));const e=document.createElement("canvas");e.width=b,e.height=c;const f=e.getContext("2d");return f.drawImage(a,0,0,b,c),e},videoFrameToCanvas:function(a,b,c,d){d&&(a.videoWidth>a.videoHeight?c*=a.videoHeight/a.videoWidth:a.height>a.videoWidth&&(b*=a.videoWidth/a.videoHeight));const e=document.createElement("canvas");e.width=b,e.height=c;const f=e.getContext("2d");return f.drawImage(a,0,0,b,c),e},applyGLSLFragmentShader:function(a,b,c){const d=document.createElement("canvas");d.width=a.width,d.height=a.height;let e=d.getContext("webgl2");if(e||(e=d.getContext("webgl")),!e)throw"Browser does not support WebGL";e.viewport(0,0,a.width,a.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT);const f={};f.verts=[-1,1,0,-1,-1,0,1,-1,0,1,1,0],f.normals=[],f.indices=[0,1,3,2],f.texcoords=[0,0,0,1,1,1,1,0],f.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(f.verts),e.STATIC_DRAW),f.vertexBuffer.itemSize=3,f.vertexBuffer.numItems=f.verts.length/3,f.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(f.indices),e.STATIC_DRAW),f.indexBuffer.itemSize=1,f.indexBuffer.numItems=f.indices.length,f.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,f.texcoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(f.texcoords),e.STATIC_DRAW),f.texcoordBuffer.itemSize=2,f.texcoordBuffer.numItems=f.texcoords.length/2;const g=new Float32Array([1,0,0,0,0,1,0,0,0,0,.019980020821094513,0,-0,-0,-.9980019927024841,1]),h=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-0,-0,-0,1]),j=e.createProgram(),k=e.createShader(e.VERTEX_SHADER);e.shaderSource(k,`
                attribute vec3 aVertexPosition;
                attribute vec2 aTextureCoord;
                uniform mat4 uMVMatrix;
                uniform mat4 uPMatrix;
                varying vec2 vTextureCoord;
                
                void main(void) {
                    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
                    vTextureCoord = aTextureCoord;
                }            
            `),e.compileShader(k);const l=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(l,b),e.compileShader(l),e.attachShader(j,k),e.attachShader(j,l),e.linkProgram(j),j.vertexPositionAttribute=e.getAttribLocation(j,"aVertexPosition"),j.pMatrixUniform=e.getUniformLocation(j,"uPMatrix"),j.mvMatrixUniform=e.getUniformLocation(j,"uMVMatrix"),j.textureCoordAttribute=e.getAttribLocation(j,"aTextureCoord"),e.enableVertexAttribArray(j.vertexPositionAttribute),e.enableVertexAttribArray(j.textureCoordAttribute);const m=e.createTexture();e.useProgram(j),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,m),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.uniform1i(j.samplerUniform,0),e.bindBuffer(e.ARRAY_BUFFER,f.vertexBuffer),e.vertexAttribPointer(j.vertexPositionAttribute,f.vertexBuffer.itemSize,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,f.texcoordBuffer),e.vertexAttribPointer(j.textureCoordAttribute,f.texcoordBuffer.itemSize,e.FLOAT,!1,0,0),e.uniformMatrix4fv(j.pMatrixUniform,!1,g),e.uniformMatrix4fv(j.mvMatrixUniform,!1,h),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.indexBuffer),e.uniform1f(e.getUniformLocation(j,"uSceneWidth"),e.viewportWidth),e.uniform1f(e.getUniformLocation(j,"uSceneHeight"),e.viewportHeight),e.uniform1i(e.getUniformLocation(j,"uSampler"),0);for(let d=0;d<c.length;d++)if("1f"===c[d].type)e.uniform1f(e.getUniformLocation(j,c[d].name),c[d].x);else if("1i"===c[d].type)e.uniform1i(e.getUniformLocation(j,c[d].name),c[d].x);else if("2f"===c[d].type)e.uniform2f(e.getUniformLocation(j,c[d].name),c[d].x,c[d].y);else if("2i"===c[d].type)e.uniform2i(e.getUniformLocation(j,c[d].name),c[d].x,c[d].y);else if("3f"===c[d].type)e.uniform3f(e.getUniformLocation(j,c[d].name),c[d].x,c[d].y,c[d].z);else if("3i"===c[d].type)e.uniform3i(e.getUniformLocation(j,c[d].name),c[d].x,c[d].y,c[d].z);else if("4f"===c[d].type)e.uniform4f(e.getUniformLocation(j,c[d].name),c[d].x,c[d].y,c[d].z,c[d].w);else if("4i"===c[d].type)e.uniform4i(e.getUniformLocation(j,c[d].name),c[d].x,c[d].y,c[d].z,c[d].w);else throw"Invalid shader var specified";e.drawElements(e.TRIANGLE_STRIP,f.indexBuffer.numItems,e.UNSIGNED_SHORT,0);const n=a.getContext("2d");return n.drawImage(d,0,0,a.width,a.height),a},applyKernel:function(a,c){const d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height).data,f=new Uint8ClampedArray(4*(a.width*a.height)),g=c.getWidth(),h=c.getMatrixArray();for(let d=0;d<a.height;d++)for(let c,i=0;i<a.width;i++){c=[0,0,0,0];for(let f=0;f<g;f++)for(let j=0;j<g;j++){const k=j+f*g,l=j-(g-1)/2,m=f-(g-1)/2;let n=i+l,o=d+m;if(0>n||0>o||n>=a.width||o>=a.height)continue;const p=b(e,a.width,n,o);c[0]+=h[k]*p[0],c[1]+=h[k]*p[1],c[2]+=h[k]*p[2],0===l&&0===m&&(c[3]=p[3])}const j=4*(i+d*a.width);f[j+0]=parseInt(255*c[0]),f[j+1]=parseInt(255*c[1]),f[j+2]=parseInt(255*c[2]),f[j+3]=parseInt(255*c[3])}return d.putImageData(new ImageData(f,a.width,a.height),0,0),a},toGrayscale:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=0;e<d.data.length;e+=4)b=parseInt(255*(.2126*(d.data[e]/255)+.7152*(d.data[e+1]/255)+.0722*(d.data[e+2]/255))),d.data[e]=b,d.data[e+1]=b,d.data[e+2]=b;return c.putImageData(d,0,0),a},toBlackAndWhite:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=0;e<d.data.length;e+=4)b=.2126*(d.data[e]/255)+.7152*(d.data[e+1]/255)+.0722*(d.data[e+2]/255),.5>b?(d.data[e]=0,d.data[e+1]=0,d.data[e+2]=0,d.data[e+3]=255):(d.data[e]=255,d.data[e+1]=255,d.data[e+2]=255,d.data[e+3]=255);return c.putImageData(d,0,0),a},computeColorFrequencyMap:function(b){for(var c,d=new Map,e=b.getContext("2d"),f=e.getImageData(0,0,b.width,b.height),g=0;g<f.data.length;g+=4)c=a(f.data[g],f.data[g+1],f.data[g+2],f.data[g+3]),d.has(c)?d.set(c,d.get(c)+1):d.set(c,1);return d}}}();"undefined"!=typeof module&&module.exports&&(module.exports=CanvasImageTransformer);